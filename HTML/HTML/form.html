<!DOCTYPE html>
<html>
  <head>
    <title>Parking registration form</title>
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.4.1/css/all.css"
      integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700"
      rel="stylesheet"
    />
    <style>
      html,
      body {
        min-height: 100%;
      }
      body,
      div,
      form,
      input,
      select,
      p {
        padding: 0;
        margin: 0;
        outline: none;
        font-family: Roboto, Arial, sans-serif;
        font-size: 16px;
        color: #eee;
      }
      body {
        background: url("/hello.jpg") no-repeat center;
        background-size: cover;
      }
      h1,
      h2 {
        text-transform: uppercase;
        font-weight: 400;
      }
      h2 {
        margin: 0 0 0 8px;
      }
      .main-block {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100%;
        padding: 25px;
        background: rgba(0, 0, 0, 0.5);
      }
      .left-part,
      form {
        padding: 25px;
      }
      .left-part {
        text-align: center;
      }
      .fa-graduation-cap {
        font-size: 72px;
      }
      form {
        background: rgba(0, 0, 0, 0.7);
      }
      .title {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
      }
      .info {
        display: flex;
        flex-direction: column;
      }
      input,
      select {
        padding: 5px;
        margin-bottom: 30px;
        background: transparent;
        border: none;
        border-bottom: 1px solid #eee;
      }
      input::placeholder {
        color: #eee;
      }
      option:focus {
        border: none;
      }
      option {
        background: black;
        border: none;
      }
      .checkbox input {
        margin: 0 10px 0 0;
        vertical-align: middle;
      }
      .checkbox a {
        color: #26a9e0;
      }
      .checkbox a:hover {
        color: #85d6de;
      }
      .btn-item,
      button {
        padding: 10px 5px;
        margin-top: 20px;
        border-radius: 5px;
        border: none;
        background: #26a9e0;
        text-decoration: none;
        font-size: 15px;
        font-weight: 400;
        color: #fff;
      }
      .btn-item {
        display: inline-block;
        margin: 20px 5px 0;
      }
      button {
        width: 100%;
      }
      button:hover,
      .btn-item:hover {
        background: #85d6de;
      }
      @media (min-width: 568px) {
        html,
        body {
          height: 100%;
        }
        .main-block {
          flex-direction: row;
          height: calc(100% - 50px);
        }
        .left-part,
        form {
          flex: 1;
          height: auto;
        }
      }
    </style>
  </head>
  <body>
    <div class="main-block">
      <div class="left-part">
         <!-- Placeholder for QR code image -->
         <div id="qrCodePlaceholder" style="display: none;">
          <img src="" alt="QR Code" id="qrCodeImage" />
          <h3>Use this QR Code for entry</h3>
        </div>
        
        <!-- Content to be displayed before payment -->
        <div id="contentBeforePayment">
          <i class="fas fa-car fa-6x"></i>
          <h1>Welcome to EasyPark</h1>
          <p>We provide parking in an easy and quick way near you.</p>
        </div>
      </div>
      <form action="/">
        <div class="title">
          <i class="fas fa-pencil-alt"></i>
          <h2>Register here</h2>
        </div>
        <div class="info">
          <input
            class="fname"
            type="text"
            name="name"
            placeholder="Full name"
          />
          <input required type="text" name="email" placeholder="Email" />
          <!-- <input
            required
            type="tel"
            name="name"
            placeholder="Phone number"
            maxlength="10"
            minlength="10"
          /> -->
          <input
            type="tel"
            name="telphone"
            placeholder="Phone number"
            maxlength="`10"
            title="Ten digits code"
            required
          />
          <input
            required
            type="carnumber"
            name="carnumber"
            placeholder="Car number"
          />
          <select name="time-duration">
            <option value="time-duration" selected>Select-time*</option>
            <option value=""></option>
            <option value=""></option>
            <option value=""></option>
            <option value=""></option>
            <option value=""></option>
            <option value=""></option>
            <option value=""></option>
          </select>
        </div>
        <!-- <div class="checkbox">
          <input type="checkbox" name="checkbox" /><span
            >I agree to the <a href="">Privacy Poalicy for EasyPark.</a></span
          >
        </div> -->
        <button type="submit">Pay Now</button>
      </form>
    </div>
    
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        // Define your variables here
        const formData = {
            name: '',
            email: '',
            telephone: '',
            carNumber: '',
            timeDuration: '',
            agreeToPrivacyPolicy: false,
        };

        const errors = {};

        function displayQRCode(imageUrl) {
        const qrCodePlaceholder = document.getElementById('qrCodePlaceholder');
        const qrCodeImage = document.getElementById('qrCodeImage');

        qrCodeImage.src = imageUrl;
        qrCodePlaceholder.style.display = 'block';
        document.getElementById('contentBeforePayment').style.display = 'none';
      }
        // Function to handle form submission
        function handleSubmit(e) {
            e.preventDefault();
            
console.log(e);
            // Client-side validation
            const validationErrors = {};

            // if (!formData.name.trim()) {
            //     validationErrors.name = 'Name is required';
            // }

            // if (!formData.email.trim()) {
            //     validationErrors.email = 'Email is required';
            // }

            // if (!formData.telephone.trim()) {
            //     validationErrors.telephone = 'Phone number is required';
            // }

            // if (!formData.carNumber.trim()) {
            //     validationErrors.carNumber = 'Car number is required';
            // }

            // Display validation errors...
            // document.getElementById('name-error').textContent = validationErrors.name || '';
            // document.getElementById('email-error').textContent = validationErrors.email || '';
            // document.getElementById('telephone-error').textContent = validationErrors.telephone || '';
            // document.getElementById('carNumber-error').textContent = validationErrors.carNumber || '';

            if (Object.keys(validationErrors).length > 0) {
              console.log('errr');
                return;
            }else{
              
            initRazorpay();
            }
            // Razorpay payment code...
        }

        // Function to handle form input changes
        function handleChange(e) {
            const { name, value, type, checked } = e.target;
            formData[name] = type === 'checkbox' ? checked : value;
        }

        // Function to initialize Razorpay and handle payment
       async function initRazorpay() {
          const data = await fetch('https://parkingman-production.up.railway.app/api/create/order', {
        method: 'POST',
        // mode: 'no-cors',
        body: JSON.stringify({
          amount: 5000, // Amount in currency subunits (e.g., 50000 for 500.00 INR)
          currency: 'INR',
          receipt: "order_rcptid_11"
        }),
        headers: { 'Content-type': 'application/json' },
    }).then((t) =>
        // console.log(t)
        t.json()
    )
    console.log(data);
            // Replace 'YOUR_KEY_ID' with your actual Razorpay Key ID
            const key = 'rzp_test_mSEHCojzJFuuF0';

            const options = {
                key,
                amount: 5000, // Amount in currency subunits (e.g., 50000 for 500.00 INR)
                currency: 'INR',
                name: 'Acme Corp', // Your business name
                description: 'Test Transaction',
                image: 'https://example.com/your_logo',
                order_id: `${data.order.id}`, // Replace with your actual Order ID
                // callback_url: 'https://eneqd3r9zrjok.x.pipedream.net/',
                handler: async function (response) {
            console.log(response);
            alert("Payment Successful");
            // Create an object to hold the form data
  const formData = {
    name: document.querySelector('input[name="name"]').value,
    email: document.querySelector('input[name="email"]').value,
    phoneNumber: document.querySelector('input[name="telphone"]').value,
    carNumber: document.querySelector('input[name="carnumber"]').value,
    time: document.querySelector('select[name="time-duration"]').value
  };

  // Make an HTTP POST request to your API
  try {
    const response = await fetch('https://parkingman-production.up.railway.app/api/parking-payment', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(formData),
    });

    if (response.ok) {
      // Request was successful
      const responseData = await response.json();
      // Handle the API response as needed
      
      console.log(responseData.message);
      console.log(responseData.qrCode);
     
      const imageUrl =  responseData.qrCode;
        displayQRCode(imageUrl);
    } else {
      // Request failed
      console.error('API request failed');
    }
  } catch (error) {
    console.error('An error occurred while sending the request:', error);
  }
        },
                prefill: {
                    name: 'Gaurav Kumar', // Customer's name
                    email: 'gaurav.kumar@example.com',
                    contact: '9000090000', // Customer's phone number
                },
                notes: {
                    address: 'Razorpay Corporate Office',
                },
                theme: {
                    color: '#3399cc',
                },
            };

            const rzp1 = new Razorpay(options);

            // Function to handle Razorpay payment dialog
            // function handleClick() {
                rzp1.open();
            // }

            // Attach the event listener to your button
            // const payButton = document.getElementById('rzp-button1');
            // if (payButton) {
            //     payButton.addEventListener('click', handleClick);
            // }

            // Cleanup by removing the event listener when needed...
        }

        // Add event listeners or call functions as needed
        // document.addEventListener('DOMContentLoaded', () => {
        //     // Initialize Razorpay
        //     // initRazorpay();

        //     // Add event listeners for form elements...
           
        // });
        const form = document.querySelector('form');
            form.addEventListener('submit', handleSubmit);

            const inputs = document.querySelectorAll('input[name], select[name]');
            inputs.forEach((input) => {
                input.addEventListener('change', handleChange);
            });
    </script>
  </body>
  
</html>
